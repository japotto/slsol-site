<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Queen of Hearts Fundraiser | Sons of the American Legion</title>
  <meta name="description" content="Queen of Hearts fundraiser supporting U.S. military veterans through the Sons of the American Legion." />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <header class="site-header">
    <div class="container">
      <div class="brand">
        <div class="mark" aria-hidden="true">★</div>
        <div>
          <div class="eyebrow">Sons of the American Legion</div>
          <h1 class="title">Queen of Hearts Fundraising Game</h1>
        </div>
      </div>

      <nav class="nav">
        <a href="#board">Game Board</a>
        <a href="#details">Next Drawing</a>
        <a class="button small" href="rules.html">Rules</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- HERO -->
    <section class="hero">
      <div class="hero-card">
        <p class="hero-lead">
          Supporting U.S. military veterans through local programs and community service.
        </p>

        <div class="stats">
          <div class="stat">
            <div class="stat-label">Current Pot</div>
            <div class="stat-value" id="potAmount">$0</div>
            <div class="stat-sub">Updated: <span id="potUpdated">—</span></div>
          </div>

          <div class="stat">
            <div class="stat-label">Next Drawing</div>
            <div class="stat-value" id="nextDrawingDate">TBD</div>
            <div class="stat-sub" id="nextDrawingLocation">Location TBD</div>
          </div>
        </div>

        <div class="cta-row">
          <a class="button" href="#board">View Current Board</a>
          <a class="button ghost" href="rules.html">Read the Rules</a>
        </div>
      </div>

      <div class="hero-aside">
        <div class="card">
          <h2 class="card-title">Where the proceeds go</h2>
          <p class="muted">
            Proceeds support veteran-focused programs and services, including assistance for veterans and families,
            community support initiatives, and American Legion–related charitable efforts.
          </p>
          <p class="muted">
            Want to learn more about the Sons of the American Legion? Visit the national organization for background and mission.
          </p>
          <!-- Replace with your preferred link (national SAL page, local post page, etc.) -->
          <a class="link" href="#" target="_blank" rel="noopener">Learn more about SAL →</a>
        </div>

        <div class="card subtle">
          <h2 class="card-title">Quick Notes</h2>
          <ul class="bullets">
            <li>Bring your ticket/entry details to the drawing.</li>
            <li>Winners and rules are determined by the posted game rules.</li>
            <li>Please check back after each drawing for updates.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- BOARD -->
    <section id="board" class="section">
      <div class="section-head">
        <h2>Current Game Board</h2>
        <p class="muted">Latest posted board image for the current game.</p>
      </div>

      <div class="board-wrap">
        <!-- Put your current board image in the same folder and name it board.jpg (or change this filename). -->
        <img class="board-image" src="board.jpg" alt="Queen of Hearts game board" />
      </div>
    </section>

    <!-- DETAILS -->
    <section id="details" class="section">
      <div class="section-head">
        <h2>Next Drawing Details</h2>
        <p class="muted">Confirmed time and place for the next draw.</p>
      </div>

      <div class="grid-2">
        <div class="card">
          <h3 class="card-title">Date & Time</h3>
          <p class="big" id="nextDrawingDate2">TBD</p>
          <p class="muted">Please arrive a little early if you’d like to attend in person.</p>
        </div>

        <div class="card">
          <h3 class="card-title">Location</h3>
          <p class="big" id="nextDrawingLocation2">Location TBD</p>
          <p class="muted">Contact your local SAL organizers if you need directions.</p>
        </div>
      </div>

      <div class="notice">
        <strong>Rules:</strong> Please review the <a href="rules.html">official game rules</a> for eligibility, payout, and drawing procedures.
      </div>
    </section>

    <footer class="site-footer">
      <div class="footer-inner">
        <div class="muted">© <span id="year"></span> Sons of the American Legion • Queen of Hearts</div>
        <div class="muted small">This site is informational for the fundraiser; see rules for official terms.</div>
      </div>
    </footer>
  </main>

<div id="debugStatus" style="font-family: monospace; font-size: 12px; opacity: 0.75; padding: 8px;">
  debug: (loading…)
</div>
  
  <script>
(async function () {
  try {
    const yearEl = document.getElementById("year");
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    const res = await fetch("status.json", { cache: "no-store" });
    const s = await res.json();

    console.log("board_image_url from status.json:", s.board_image_url);
    const dbg = document.getElementById("debugStatus");
    if (dbg) dbg.textContent =
      "status.json board_image_url = " + (s.board_image_url || "(missing)");

    // Update the board image with retry + cache-bust
    const img = document.querySelector(".board-image");
    const fallbackSrc = "board.jpg";

    function setFallback() {
      if (img) img.src = fallbackSrc;
    }

    async function tryLoad(url, attempts = 3) {
      for (let i = 0; i < attempts; i++) {
        const bust = (url.includes("?") ? "&" : "?") + "v=" + Date.now() + "-" + i;
        const testUrl = url + bust;

        const ok = await new Promise((resolve) => {
          const probe = new Image();
          probe.onload = () => resolve(true);
          probe.onerror = () => resolve(false);
          probe.src = testUrl;
        });

        if (ok) {
          if (img) img.src = testUrl;
          // Simple test change.
          console.log("Image loaded OK:", testUrl);
          return true;
        }

        await new Promise(r => setTimeout(r, 250));
      }
      return false;
    }

function extractDriveId(url) {
  // supports ...uc?id=FILE_ID and ...download?id=FILE_ID
  const m = url.match(/[?&]id=([^&]+)/);
  return m && m[1] ? m[1] : null;
}

function buildDriveUrls(originalUrl) {
  const id = extractDriveId(originalUrl);
  if (!id) return { originalUrl, id: null, candidates: [originalUrl] };

  // Try multiple "direct" variants; one usually works best depending on browser/policies
  const candidates = [
    // Google Drive "uc"
    `https://drive.google.com/uc?id=${id}`,
    // Googleusercontent direct delivery
    `https://drive.usercontent.google.com/download?id=${id}&export=view`,
    // Another commonly-working direct host
    `https://lh3.googleusercontent.com/d/${id}`,
  ];

  return { originalUrl, id, candidates };
}

async function tryLoad(url, attempts = 3) {
  for (let i = 0; i < attempts; i++) {
    const bust = (url.includes("?") ? "&" : "?") + "v=" + Date.now() + "-" + i;
    const testUrl = url + bust;

    console.log(`[QOH] tryLoad attempt ${i + 1}/${attempts}:`, testUrl);

    const ok = await new Promise((resolve) => {
      const probe = new Image();
      probe.onload = () => resolve(true);
      probe.onerror = () => resolve(false);
      probe.src = testUrl;
    });

    console.log(`[QOH] tryLoad result attempt ${i + 1}:`, ok ? "OK" : "FAIL");

    if (ok) {
      img.src = testUrl;
      console.log("[QOH] Set <img> src to:", img.src);
      return true;
    }

    await new Promise(r => setTimeout(r, 250));
  }
  return false;
}

if (!img) {
  console.warn("[QOH] .board-image element not found. Falling back.");
  setFallback();
} else if (!s.board_image_url) {
  console.warn("[QOH] status.json missing board_image_url. Falling back.");
  setFallback();
} else {
  const { originalUrl, id, candidates } = buildDriveUrls(s.board_image_url);
  console.log("[QOH] status.json board_image_url:", originalUrl);
  console.log("[QOH] extracted Drive file id:", id);
  console.log("[QOH] candidate image URLs:", candidates);

  let success = false;
  for (const candidate of candidates) {
    console.log("[QOH] Trying candidate:", candidate);
    success = await tryLoad(candidate, 2);
    if (success) break;
  }

  if (!success) {
    console.warn("[QOH] All candidates failed. Falling back to board.jpg");
    setFallback();
  }
}

    // Update text fields
    const potEl = document.getElementById("potAmount");
    if (potEl && typeof s.pot_amount === "number") {
      potEl.textContent = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
        maximumFractionDigits: 0
      }).format(s.pot_amount);
    }

    const updEl = document.getElementById("potUpdated");
    if (updEl && s.pot_updated) updEl.textContent = s.pot_updated;

    const ndEl = document.getElementById("nextDrawingDate");
    if (ndEl && s.next_date) ndEl.textContent = s.next_date;

    const nlEl = document.getElementById("nextDrawingLocation");
    if (nlEl && s.next_location) nlEl.textContent = s.next_location;

    const ndEl2 = document.getElementById("nextDrawingDate2");
    if (ndEl2 && s.next_date) ndEl2.textContent = s.next_date;

    const nlEl2 = document.getElementById("nextDrawingLocation2");
    if (nlEl2 && s.next_location) nlEl2.textContent = s.next_location;

  } catch (err) {
    console.error("Failed to load status.json:", err);
    const img = document.querySelector(".board-image");
    if (img) img.src = "board.jpg";
  }
})();
</script>
</body>

</html>







